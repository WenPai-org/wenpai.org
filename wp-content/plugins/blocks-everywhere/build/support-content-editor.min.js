(()=>{var e={184:(e,t)=>{var r;!function(){"use strict";var n={}.hasOwnProperty;function o(){for(var e=[],t=0;t<arguments.length;t++){var r=arguments[t];if(r){var s=typeof r;if("string"===s||"number"===s)e.push(r);else if(Array.isArray(r)){if(r.length){var a=o.apply(null,r);a&&e.push(a)}}else if("object"===s)if(r.toString===Object.prototype.toString)for(var c in r)n.call(r,c)&&r[c]&&e.push(c);else e.push(r.toString())}}return e.join(" ")}e.exports?(o.default=o,e.exports=o):void 0===(r=function(){return o}.apply(t,[]))||(e.exports=r)}()}},t={};function r(n){var o=t[n];if(void 0!==o)return o.exports;var s=t[n]={exports:{}};return e[n](s,s.exports,r),s.exports}r.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return r.d(t,{a:t}),t},r.d=(e,t)=>{for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{"use strict";const e=window.React,t=window.wp.blocks,n=window.wp.element,o=window.wp.i18n,s=/^https?:\/\/wordpress\.com\/((?<lang>[a-z]{2})\/)?support\/(?<slug>[^# ]+)/i,a=/^https?:\/\/(?<domain>[-a-zA-Z0-9@:%._+~#=]*)\/((?<lang>[a-z]{2})\/)?(?<prefix>[-a-zA-Z0-9@:%._+~#=\/]*)topic\/(?<slug>\S+)$/i,c=400;var l;function u(e){return s.test(e)?l.SUPPORT_PAGE:a.test(e)?l.FORUM_TOPIC:null}async function i(e,t,r){try{const n=r?`https://public-api.wordpress.com/rest/v1.1/users/${e}`:`https://${t}/wp-json/wp/v2/users/${e}`,o=await fetch(n);if(!o.ok)return null;const s=await o.json();return s.display_name||s.name}catch(e){return}}function p(e){return(new DOMParser).parseFromString(e,"text/html").body.textContent||""}!function(e){e.SUPPORT_PAGE="support_page",e.FORUM_TOPIC="forum_topic"}(l||(l={}));const m=window.wp.blockEditor,d=window.wp.components,h=window.wp.compose,b=window.wp.primitives,f=(0,e.createElement)(b.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},(0,e.createElement)(b.Path,{d:"m19 7-3-3-8.5 8.5-1 4 4-1L19 7Zm-7 11.5H5V20h7v-1.5Z"}));var v=r(184),w=r.n(v);function _(e,t){return e===t}function E(e,t){return t}const g=t=>{const[r,s]=(0,n.useState)([]),[a,c]=(0,n.useState)(!1),[l]=(u=t.search,p=_,m=(0,e.useReducer)(E,u),h=m[0],b=m[1],f=function(t,r,n){var o=this,s=(0,e.useRef)(null),a=(0,e.useRef)(0),c=(0,e.useRef)(null),l=(0,e.useRef)([]),u=(0,e.useRef)(),i=(0,e.useRef)(),p=(0,e.useRef)(t),m=(0,e.useRef)(!0);p.current=t;var d="undefined"!=typeof window,h=!r&&0!==r&&d;if("function"!=typeof t)throw new TypeError("Expected a function");r=+r||0;var b=!!(n=n||{}).leading,f=!("trailing"in n)||!!n.trailing,v="maxWait"in n,w="debounceOnServer"in n&&!!n.debounceOnServer,_=v?Math.max(+n.maxWait||0,r):null;(0,e.useEffect)((function(){return m.current=!0,function(){m.current=!1}}),[]);var E=(0,e.useMemo)((function(){var e=function(e){var t=l.current,r=u.current;return l.current=u.current=null,a.current=e,i.current=p.current.apply(r,t)},t=function(e,t){h&&cancelAnimationFrame(c.current),c.current=h?requestAnimationFrame(e):setTimeout(e,t)},n=function(e){if(!m.current)return!1;var t=e-s.current;return!s.current||t>=r||t<0||v&&e-a.current>=_},E=function(t){return c.current=null,f&&l.current?e(t):(l.current=u.current=null,i.current)},g=function e(){var o=Date.now();if(n(o))return E(o);if(m.current){var c=r-(o-s.current),l=v?Math.min(c,_-(o-a.current)):c;t(e,l)}},k=function(){if(d||w){var p=Date.now(),h=n(p);if(l.current=[].slice.call(arguments),u.current=o,s.current=p,h){if(!c.current&&m.current)return a.current=s.current,t(g,r),b?e(s.current):i.current;if(v)return t(g,r),e(s.current)}return c.current||t(g,r),i.current}};return k.cancel=function(){c.current&&(h?cancelAnimationFrame(c.current):clearTimeout(c.current)),a.current=0,l.current=s.current=u.current=c.current=null},k.isPending=function(){return!!c.current},k.flush=function(){return c.current?E(Date.now()):i.current},k}),[b,v,r,_,f,h,d,w]);return E}((0,e.useCallback)((function(e){return b(e)}),[b]),1e3,i),v=(0,e.useRef)(u),p(v.current,u)||(f(u),v.current=u),[h,f]);var u,i,p,m,h,b,f,v;return(0,n.useEffect)((()=>{s([]),c(!0)}),[t.search]),(0,n.useEffect)((()=>{(async function(e){const t=`https://public-api.wordpress.com/wp/v2/sites/en.support.wordpress.com/pages?search=${encodeURIComponent(e)}`,r=await fetch(t);if(!r.ok)return[];const n=(await r.json()).map((e=>({title:e.title.rendered.replace("&nbsp;"," "),url:e.link.replace("en.support.wordpress.com","wordpress.com/support")})));return n.length>k?n.slice(0,k):n})(l).then((e=>{s(e),c(!1)}))}),[l]),a||0!==r.length?(0,e.createElement)("div",{className:"be-support-content-search-results"},(0,e.createElement)("div",{className:"be-support-content-search-results__list"},a&&(0,e.createElement)("div",{className:"be-support-content-search-results__loading"},(0,e.createElement)(d.Spinner,null),(0,e.createElement)("span",null,(0,o.__)("Loading content suggestions...","blocks-everywhere"))),r.map((r=>(0,e.createElement)("div",{className:"be-support-content-search-results__item",onClick:()=>t.setUrl(r.url)},(0,e.createElement)("div",{className:"be-support-content-search-results__title"},r.title),(0,e.createElement)("a",{className:"be-support-content-search-results__link",href:r.url,target:"_blank"},r.url)))))):null},k=5,y=t=>{const[r,s]=(0,n.useState)(null),a=t.url?.startsWith("http://")||t.url?.startsWith("https://"),c=!a&&t.url?.length>3;return(0,n.useEffect)((()=>{s(c?t.url:null)}),[t.url,c]),(0,e.createElement)("div",{className:w()("be-support-content-placeholder",t.className)},(0,e.createElement)(d.Placeholder,{icon:t.icon,label:t.label,instructions:t.instructions,notices:t.notices},(0,e.createElement)("form",{onSubmit:e=>{e.preventDefault(),t.onSubmit()}},(0,e.createElement)("input",{type:"url",value:t.url,className:"components-placeholder__input",placeholder:t.placeholder,onChange:e=>t.updateUrl(e.target.value)}),(0,e.createElement)(d.Button,{isPrimary:!0,type:"submit",disabled:!a,"aria-disabled":!a},(0,o._x)("Embed","button label","blocks-everywhere"))),c&&(0,e.createElement)("div",{className:"be-support-content-placeholder__search-slot"},(0,e.createElement)(g,{search:r,setUrl:e=>{t.updateUrl(e),s(e)}}))))},R=()=>{const t=wpBlocksEverywhere.pluginsUrl+"/build/images/wordpress.e7ce7231.png?m=1";return(0,e.createElement)("div",{className:w()("be-support-content-wordpress-icon")},(0,e.createElement)("img",{alt:"WP",src:t}))},N=t=>t.loaded?(0,e.createElement)(e.Fragment,null,t.children):(0,e.createElement)("span",{className:w()("be-support-content-inline-skeleton",{"is-hidden":t.hidden,"is-large":t.large})}),C=t=>{var r;const s=!!t.attributes.content,a=(0,o.sprintf)(
/* translators: Number of people marked this page useful, eg: "25332 people have found this useful" */
(0,o.__)("%1$d people have found this useful!","blocks-everywhere"),null!==(r=t.attributes.minutesToRead)&&void 0!==r?r:0),c=(0,o.sprintf)("in <a>%s</a>",t.attributes.source),l=t.attributes.minutesToRead||t.attributes.author||t.attributes.created;return(0,e.createElement)("div",{className:"be-support-content"},!!t.attributes.created&&(0,e.createElement)("div",{className:"be-support-content__created"},t.attributes.created),t.clickable&&(0,e.createElement)("a",{className:"be-support-content__opener",href:t.attributes.url}),(0,e.createElement)("div",{className:"be-support-content__header"},(0,e.createElement)(R,null),(0,e.createElement)("div",null,(0,e.createElement)("div",{className:"be-support-content__title"},(0,e.createElement)(N,{loaded:s},t.attributes.title)),(0,e.createElement)("div",{className:"be-support-content__source"},(0,e.createElement)(N,{hidden:!0,loaded:s},(0,n.createInterpolateElement)(c,{a:(0,e.createElement)("a",{className:"be-support-content__link",href:t.attributes.sourceURL})}))),(!s||l)&&(0,e.createElement)("div",{className:"be-support-content__details"},(0,e.createElement)(N,{loaded:s},(()=>{if(!s)return null;const r=t.attributes.minutesToRead?(0,o.sprintf)(
/* translators: Minutes it takes to read embedded support page, eg: "5 min to read" */
(0,o.__)("%1$d min read","blocks-everywhere"),t.attributes.minutesToRead):"",n=(0,e.createElement)("span",{className:"be-support-content__relative-created"},t.attributes.created&&t.showRelativeDate?(a=t.attributes.created,(0,window.moment)(a).fromNow()):"");var a;if(t.attributes.author){const s=(0,o.sprintf)(
/* translators: Person who created forum topic, eg: "Started by davidgonzalezwp" */
(0,o.__)("Started by %s","blocks-everywhere"),t.attributes.author);return(0,e.createElement)(e.Fragment,null,s," ",n," ",r)}if(t.attributes.created){
/* translators: Date when forum topic was created, eg: "Started 5 days ago" */
const t=(0,o.__)("Started","blocks-everywhere");return(0,e.createElement)(e.Fragment,null,t," ",n," ",r)}return r})())))),(0,e.createElement)("div",{className:"be-support-content__content"},(0,e.createElement)(N,{large:!0,loaded:s},t.attributes.content)),(!s||t.attributes.likes)&&(0,e.createElement)("div",{className:"be-support-content__reactions"},(0,e.createElement)(N,{loaded:s},a)))},P=t=>(0,e.createElement)("div",{className:w()("be-support-content-block-icon",{"is-margin-right":t.marginRight})},(0,e.createElement)(d.SVG,{width:"18",height:"18",viewBox:"0 0 18 18",xmlns:"http://www.w3.org/2000/svg"},(0,e.createElement)(d.Path,{d:"M2 0.75H16C16.6904 0.75 17.25 1.30964 17.25 2V16C17.25 16.6904 16.6904 17.25 16 17.25H2C1.30964 17.25 0.75 16.6904 0.75 16V2C0.75 1.30964 1.30964 0.75 2 0.75Z",stroke:"#1E1E1E",strokeWidth:"1.5"}),(0,e.createElement)(d.Path,{d:"M6 1L2 5.5L2 1L6 1Z",fill:"#1E1E1E",stroke:"#1E1E1E"}),(0,e.createElement)(d.Path,{d:"M11 12.2857L14 9L11 6",stroke:"#1E1E1E",strokeWidth:"1.5"}),(0,e.createElement)(d.Path,{d:"M7 12.2857L4 9L7 6",stroke:"#1E1E1E",strokeWidth:"1.5"}))),S=window.wp.data,U=({url:t,confirm:r,cancel:n})=>(0,e.createElement)(e.Fragment,null,(0,e.createElement)("a",{href:t,target:"_blank"},t),(0,e.createElement)("span",{className:"be-support-content-confirm-anchor"},(0,e.createElement)(d.Popover,{onFocusOutside:n,variant:"unstyled",offset:16,placement:"right-start"},(0,e.createElement)("div",{className:"be-support-content-confirm-content"},(0,e.createElement)(d.__experimentalElevation,{value:3}),(0,e.createElement)(d.NavigableMenu,{role:"menu"},(0,e.createElement)(d.MenuItem,{variant:"tertiary",className:"be-support-content-confirm-content__item",onClick:e=>{e.preventDefault(),r()}},(0,o.__)("Create embed","blocks-everywhere")),(0,e.createElement)(d.MenuItem,{variant:"tertiary",isDestructive:!0,className:"be-support-content-confirm-content__item",onClick:e=>{e.preventDefault(),n()}},(0,o.__)("Dismiss","blocks-everywhere"))))))),x=(0,h.compose)(d.withNotices)((r=>{const{attributes:h,className:b,setAttributes:v,noticeOperations:w,noticeUI:_}=r,{replaceBlock:E}=(0,S.useDispatch)("core/editor"),g=(0,o.__)("Embed a Support doc or a forum topic.","blocks-everywhere"),k=(0,o.__)("It does not look like a Support doc or a forum topic URL.","blocks-everywhere"),R=(0,o.__)("Search or insert URL","blocks-everywhere"),[N,x]=(0,n.useState)(r.attributes.isConfirmed),[O,L]=(0,n.useState)(!1),[T,$]=(0,n.useState)(h.url),[F,M]=(0,n.useState)(!1);(0,n.useEffect)((()=>{M(!0)}),[]);const A=async()=>{if(!u(T))return w.removeAllNotices(),void w.createErrorNotice(k);try{w.removeAllNotices(),L(!1),v({url:T,content:null});const e=await async function(e){const t=await u(e);if(t==l.SUPPORT_PAGE)return async function(e){const{blog:t,slug:r}=function(e){var t,r;const n=e.match(s),o=null!==(t=n?.groups?.lang)&&void 0!==t?t:"en";let a=null!==(r=n?.groups?.slug)&&void 0!==r?r:"";return a.endsWith("/")&&(a=a.slice(0,-1)),{blog:`${o}.support.wordpress.com`,slug:a}}(e),n=`https://public-api.wordpress.com/rest/v1.1/sites/${t}/posts/slug:${encodeURIComponent(r)}`,a=await fetch(n);if(!a.ok)throw new Error((0,o.__)("Failed to load the page. Check URL","blocks-everywhere"));const l=await a.json(),u=l.parent?.title?`${l.parent.title} Â» ${l.title}`:l.title;let i=p(l.content);const m=i.trim().split(/\s+/),d=m.length?Math.ceil(m.length/250):null;return i.length>c&&(i=i.substring(0,c)),{url:e,isConfirmed:!0,content:i,title:u,source:"WordPress.com Support",sourceURL:"https://wordpress.com/support/",minutesToRead:d}}(e);if(t==l.FORUM_TOPIC)return async function(e){const{blog:t,slug:r}=function(e){var t,r;const n=e.match(a),o=null!==(t=n?.groups?.lang)&&void 0!==t?t:"en";let s=null!==(r=n?.groups?.slug)&&void 0!==r?r:"";return s.indexOf("/")>=0&&(s=s.slice(0,s.indexOf("/"))),{blog:"wordpress.com"==n.groups.domain?`${o}.forums.wordpress.com`:n.groups.domain,slug:s}}(e),n=t.endsWith("wordpress.com"),s=n?`https://public-api.wordpress.com/wp/v2/sites/${t}/topic?slug=${encodeURIComponent(r)}`:`https://${t}/wp-json/wp/v2/topic?slug=${encodeURIComponent(r)}`,l=await fetch(s);if(!l.ok)throw new Error((0,o.__)("Failed to load the page. Check URL","blocks-everywhere"));const u=(await l.json())[0],m=p(u.title.rendered);let d=p(u.content.rendered);return d.length>c&&(d=d.substring(0,c)),{url:e,isConfirmed:!0,content:d,title:m,author:u.author?await i(u.author,t,n):void 0,source:n?"WordPress.com Forums":`${t} Forums`,sourceURL:`https://${t}`,status:u.status,created:u.date}}(e);throw new Error((0,o.__)("Failed to load the page. Check URL","blocks-everywhere"))}(T);v(e)}catch(e){L(!0),w.createErrorNotice(e.message||e||(0,o.__)("Unable to fetch the page, check the URL","blocks-everywhere"))}},B=(0,m.useBlockProps)();return N?(0,e.createElement)("div",{...B},(0,e.createElement)(m.BlockControls,null,(0,e.createElement)(d.ToolbarGroup,null,!O&&(0,e.createElement)(d.ToolbarButton,{icon:f,label:(0,o.__)("Edit URL","blocks-everywhere"),isActive:O,onClick:()=>{L(!O)}}))),O||!h.url?(0,e.createElement)(y,{className:b,icon:(0,e.createElement)(P,{marginRight:!0}),instructions:g,label:"Content Embed",url:T,notices:_,placeholder:R,onSubmit:A,updateUrl:$}):(0,e.createElement)(C,{attributes:h,showRelativeDate:!0})):(0,e.createElement)("div",{...B},F&&(0,e.createElement)(U,{url:T,confirm:async()=>{x(!0),await A()},cancel:()=>{const r=(0,e.createElement)("a",{href:T},T),o=(0,t.createBlock)("core/paragraph",{content:(0,n.renderToString)(r)});E(B["data-block"],o)}}))}));(0,t.registerBlockType)("blocks-everywhere/support-content",{title:(0,o.__)("Content Embed","blocks-everywhere"),icon:(0,e.createElement)(P,null),category:"embed",description:(0,o.__)("Embed a page from the WordPress Guide or a forum topic","blocks-everywhere"),keywords:[(0,o.__)("guide"),(0,o.__)("support"),(0,o.__)("how to"),(0,o.__)("howto"),(0,o.__)("forum"),(0,o.__)("topic")],attributes:{url:{type:"string"},isConfirmed:{type:"boolean",default:!0},title:{type:"string",source:"text",selector:".be-support-content__title"},content:{type:"string",source:"text",selector:".be-support-content__content"},source:{type:"string",source:"text",selector:".be-support-content__link"},sourceURL:{type:"string",source:"attribute",selector:".be-support-content__link",attribute:"href"},minutesToRead:{type:"number"},likes:{type:"number"},status:{type:"string"},author:{type:"string"},created:{type:"string",source:"text",selector:".be-support-content__created"}},supports:{align:!0,anchor:!0},edit:x,save:t=>{const r=m.useBlockProps.save(),{attributes:n}=t;return(0,e.createElement)("div",{...r},(0,e.createElement)(C,{attributes:n,clickable:!0}))},transforms:{from:[{type:"raw",isMatch:e=>{var t;return"P"===e.nodeName&&!!u(null!==(t=e.textContent?.trim())&&void 0!==t?t:"")},transform:e=>{var r;const n=null!==(r=e.textContent?.trim())&&void 0!==r?r:"";return(0,t.createBlock)("blocks-everywhere/support-content",{url:n,isConfirmed:!1})}}],to:[{type:"block",blocks:["core/paragraph"],transform:({url:r})=>{const o=(0,e.createElement)("a",{href:r},r);return(0,t.createBlock)("core/paragraph",{content:(0,n.renderToString)(o)})}}]}})})()})();