jQuery(document.body).ready(function($){"use strict";var profileForm,mount,message,link,currentUsernameInput,newUsernameInput,submitButton,cancelButton,minimumLength;({init:function(){this.general()},general:function(){}}).init(),{init:function(){this.general()},general:function(){"profile"!==username_changer_vars.current_screen&&"user-edit"!==username_changer_vars.current_screen||"1"!==username_changer_vars.can_change_username||(currentUsernameInput=document.getElementById("user_login"),mount=document.querySelector(".user-user-login-wrap td .description"),link=this.createElement("a",{id:"username-changer-link",href:"#",onclick:this.toggle},username_changer_vars.change_button_label),newUsernameInput=this.createElement("input",{id:"username-changer-input",type:"text",name:"new_user_login",value:currentUsernameInput.value,className:"regular-text",style:{"min-height":"28px"},autocomplete:"off"}),cancelButton=this.createElement("input",{id:"username-changer-cancel",type:"button",value:username_changer_vars.cancel_button_label,className:"button",style:{"margin-left":"5px"},onclick:this.toggle}),submitButton=this.createElement("input",{id:"username-changer-submit",type:"button",value:username_changer_vars.save_button_label,className:"button",style:{"margin-left":"5px"},onclick:this.onSubmit}),profileForm=this.createElement("form",{id:"username-changer-form",method:"POST",onsubmit:this.onSubmit,style:{display:"none"}},[newUsernameInput,submitButton,cancelButton]),message=this.createElement("p",{id:"username-changer-message",style:{display:"none"}}),mount.parentNode.replaceChild(link,mount),link.parentNode.appendChild(this.createElement("div",[profileForm,message])),minimumLength=parseInt(username_changer_vars.minimum_length),$("#username-changer-input").on("input",function(){$(this).val().length<minimumLength?(message.style.color="red",message.textContent=username_changer_vars.error_short_username,message.style.display="",submitButton.disabled=!0):!0===submitButton.disabled&&(message.style.display="none",message.textContent="",submitButton.disabled=!1,cancelButton.disabled=!1)}))},createElement:function(name,attrs,children){var e=document.createElement(name);if(children||!Array.isArray(attrs)&&"string"!=typeof attrs||(children=attrs,attrs=null),attrs&&this.setAttribute(e,attrs),children)if("string"==typeof children)e.textContent=children;else for(var i=0;i<children.length;i++)e.appendChild(children[i]);return e},setAttribute:function(object,attrs){for(var key in attrs)"object"==typeof attrs[key]?this.setAttribute(object[key],attrs[key]):object[key]=attrs[key]},toggle:function(e){e.preventDefault(),"none"===profileForm.style.display?(profileForm.style.display="",link.style.display="none",currentUsernameInput.style.display="none",newUsernameInput.focus()):(profileForm.style.display="none",link.style.display="inline",currentUsernameInput.style.display="",message.style.display="none",message.textContent="",newUsernameInput.value=currentUsernameInput.value,submitButton.disabled=!1,cancelButton.disabled=!1)},onSubmit:function(e){e.preventDefault();var postData,error=!0,newUsername=profileForm.new_user_login.value,currentUsername=currentUsernameInput.value;if(minimumLength=parseInt(username_changer_vars.minimum_length),newUsername!==currentUsername){if(submitButton.value=username_changer_vars.please_wait_message,submitButton.disabled=!0,cancelButton.disabled=!0,newUsername.length<minimumLength)return message.style.color="red",message.textContent=username_changer_vars.error_short_username,message.style.display="",submitButton.value=username_changer_vars.save_button_label,void(cancelButton.disabled=!1);postData={action:"change_username",old_username:currentUsername,new_username:newUsername,security:username_changer_vars.nonce},$.ajax({type:"POST",data:postData,dataType:"json",url:username_changer_vars.ajaxurl,success:function(response){if(null!==response)try{username_changer_vars.nonce=response.new_nonce,message.style.color=response.success?"green":"red",message.innerHTML=response.message,response.success&&(currentUsernameInput.value=newUsername,error=!1)}catch(e){message.style.color="red",message.textContent=username_changer_vars.error_unknown}else message.style.color="red",message.textContent=username_changer_vars.error_unknown;if(message.style.display="",cancelButton.disabled=!1,submitButton.value=username_changer_vars.save_button_label,!1===error)return currentUsernameInput.value=newUsername,$('input[name="nickname"]').val()===currentUsername&&$('input[name="nickname"]').val(newUsername),$('select[name="display_name"] option:selected').text()===currentUsername&&$('select[name="display_name"] option:selected').text(newUsername),profileForm.style.display="none",link.style.display="inline",void(currentUsernameInput.style.display="")}}).fail(function(data){window.console&&window.console.log&&console.log(data)})}else cancelButton.click()}}.init()});